<div class="bzform">
    <div id="validation-success"></div>
    <form id="addbzform" action="/php/add_bz.php" method="post"></form>
</div>

<script>
    function rus_to_latin(str) {
        var ru = {
                'а': 'a',
                'б': 'b',
                'в': 'v',
                'г': 'g',
                'д': 'd',
                'е': 'e',
                'ё': 'e',
                'ж': 'j',
                'з': 'z',
                'и': 'i',
                'к': 'k',
                'л': 'l',
                'м': 'm',
                'н': 'n',
                'о': 'o',
                'п': 'p',
                'р': 'r',
                'с': 's',
                'т': 't',
                'у': 'u',
                'ф': 'f',
                'х': 'h',
                'ц': 'c',
                'ч': 'ch',
                'ш': 'sh',
                'щ': 'shch',
                'ы': 'y',
                'э': 'e',
                'ю': 'u',
                'я': 'ya',
                ' ': '_'
            },
            n_str = [];

        str = str.replace(/[ъь]+/g, '').replace(/й/g, 'i');

        for (var i = 0; i < str.length; ++i) {
            n_str.push(
                ru[str[i]] ||
                ru[str[i].toLowerCase()] == undefined && str[i] ||
                ru[str[i].toLowerCase()].toUpperCase()
            );
        }
        return n_str.join('');
    }

    function imagesbuild(el) {
        var file = $(el).get(0);
        var file64 = el.files[0];
        var reader = new FileReader();
        reader.onloadend = function() {
            $("#imgbz").val(reader.result)
        }
        reader.readAsDataURL(file64);
        var preview = window.URL.createObjectURL(file.files[0]);
        if ($('.apnd-img')[0])
            $('.apnd-img').remove();
        $(el).closest('.k-form-field-wrap').find('span').append("<div class='apnd-img'><img src='" + preview + "' id='imgobloz' class='img-responsive'><i class='fa fa-close delfile'></i></div>");

    }
    $(document).ready(function() {
        var validationSuccess = $("#validation-success");
        $("#addbzform").kendoForm({
            orientation: "vertical",
            items: [{
                field: "imgbz",
                editor: "hidden"
            }, {
                field: "namebaza",
                label: "Наименование базы знаний:",
                validation: {
                    required: {
                        message: "Поле обязательно для заполнения"
                    }
                },
                editor: "TextBox",
            }, {
                field: "namebd",
                label: "Имя базы данных:",
                validation: {
                    required: {
                        message: "Поле обязательно для заполнения"
                    }
                },
                editor: "TextBox",
            }, {
                field: "imagebz",
                label: "Обложка:",
                editor: function(container, options) {
                    $('<input name="obloz" id="oblozfile" type="file" onchange="imagesbuild(this)" accept=".jpg,.png"/><div class="k-form-hint"><span>Вы можете загружать только: JPG, PNG</span></div>')
                        .appendTo(container);
                },
            }],
            messages: {
                submit: "Создать",
                clear: "Отмена",
            },
            clear: function(ev) {
                $("#oblozfile").val(null);
                $('.apnd-img').remove();
                addbz.close();
            }

        });

        $("#namebaza").on('input', function() {
            $('#namebd').val(rus_to_latin($(this).val()));
        })

    });
</script>

<style>
    .apnd-img {
        position: absolute;
        right: 0;
        margin-top: -96px;
        margin-right: 19px;
        border: 1px dashed #CCC;
        padding: 5px;
    }
    
    .apnd-img img {
        height: 95px;
    }
</style>